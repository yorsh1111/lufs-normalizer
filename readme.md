# 音声ファイルのラウドネス正規化ツール

## インストール方法

### 実行可能ファイルをダウンロードする場合

最新のリリースから、ご使用の OS に合わせた実行可能ファイルをダウンロードできます：

- Windows: `loudness_normalize-windows.exe`
- macOS: `loudness_normalize-mac`

[リリースページ](https://github.com/yorsh1111/lufs-normalizer/releases)から最新バージョンをダウンロードしてください。

### ソースコードから実行する場合

```bash
# リポジトリをクローン
git clone https://github.com/yorsh1111/lufs-normalizer.git
cd lufs-normalizer

# 依存関係のインストール
pip install pipenv
pipenv install

# 実行
pipenv run python src/loudness_normalize.py <入力ファイル> [出力ファイル] [オプション]
```

## 使い方

```bash
python loudness_normalize.py <入力ファイル> [出力ファイル] [オプション]
```

### 基本的な使い方

**出力先を指定する場合:**

```bash
python loudness_normalize.py input.wav output.wav
```

**出力先を指定しない場合:**

```bash
python loudness_normalize.py input.wav
```

※出力ファイルを指定しない場合、入力ファイルと同じディレクトリに「output」フォルダを作成し、その中に同名で出力します。

### オプション

- `-t, --target`: 目標ラウドネス値（LUFS）を指定（デフォルト: -14.0 [Spotify 標準]）
- `-p, --peak`: True Peak リミット（dBTP）を指定（デフォルト: -1.0 [Spotify 推奨]）
- `-tol, --tolerance`: 目標ラウドネスからの許容値（LU）を指定（デフォルト: 0.5）
- `-m, --max-attempts`: 最大試行回数を指定（デフォルト: 5）

### プリセット例

以下のようなプリセット値が一般的に使われています：

- 標準（Spotify）: -14.0 LUFS / -1.0 dBTP
- 大音量（Spotify Premium）: -11.0 LUFS / -1.0 dBTP
- 小音量（Spotify Premium）: -19.0 LUFS / -1.0 dBTP

### 詳細な使用例

**カスタム目標ラウドネス値を指定:**

```bash
python loudness_normalize.py input.wav -t -16.0
```

**True Peak リミットを指定:**

```bash
python loudness_normalize.py input.wav -p -2.0
```

**許容値と最大試行回数を指定:**

```bash
python loudness_normalize.py input.wav -tol 0.3 -m 3
```

**すべてのオプションを組み合わせ:**

```bash
python loudness_normalize.py input.wav output.wav -t -16.0 -p -1.0 -tol 0.3 -m 3
```

### 機能説明

このツールは、指定した目標ラウドネス値に音声ファイルを正規化します。許容値内に収まらない場合は、最大試行回数まで繰り返し処理を行います。各試行では、前回の結果を基に再度正規化を行うことで、より精度の高い結果を得ることができます。

### 対応ファイル形式

- WAV (.wav)
- MP3 (.mp3)
- FLAC (.flac)

出力ファイルは入力ファイルと同じ形式で保存されます。

## 概要

本プログラムは、音声ファイル（wav、mp3、flac 形式に対応）のラウドネスレベルを特定の数値基準に合わせて正規化するためのツールです。ラウドネス正規化とは、人間の聴覚特性に基づいた音量調整の手法です。

**主な用途：**

- 複数の音声ファイルの音量を揃えたいとき
- 動画や音楽配信サービスにアップロードする前に、そのサービスだとどう聞こえるかを確認したいとき
- クライアントへの音声ファイル納品前に、音量レベルが適切かどうかチェックしたいとき

## 注意事項

※このツールはあくまでお試しツールです。ラウドネス正規化は必ずしもすべての音源で目標値に正確に到達できるわけではありません。特に以下のような場合は目標値との差が生じる可能性があります：

- ダイナミックレンジが非常に広い音源
- 非常に静かな部分と大きな音が混在する音源
- True Peak リミッターが適用される場合（ピーク制限により目標ラウドネスに到達できない）

正規化処理は目標値に到達できない場合でも、常に処理結果を出力ファイルとして保存します。処理の成否にかかわらず、出力された音声ファイルを確認し、必要に応じて再度パラメーターを調整してお試しください。

※このツールの使用によるいかなる問題や損害についても、責任を負いかねますのでご了承ください。

## 開発者向け情報

### リポジトリのクローンとセットアップ

```bash
git clone https://github.com/yorsh1111/lufs-normalizer.git
cd lufs-normalizer
pip install pipenv
pipenv install
```

### コマンド

```bash
# コードのフォーマット
pipenv run format

# Lint
pipenv run lint

# 実行可能ファイルのビルド
pipenv run build
```

### リリース方法

このプロジェクトは GitHub Actions を使用して自動的にビルドとリリースを行います。

1. `main` ブランチに変更をプッシュするだけで自動的にビルドとリリースが行われます

   ```bash
   git push origin main
   ```

2. GitHub Actions が自動的に実行され、以下のプラットフォーム用の実行可能ファイルがビルドされます：

   - macOS
   - Windows

3. ビルドが完了すると、リリースページに新しいリリースが自動的に作成され、実行可能ファイルが添付されます。

## 音量調整（ラウドネス正規化）について

### 「音量調整」とはどういうこと？

音量調整（正規化）とは、バラバラな音量を持つ音声ファイルを、ある一定の基準に合わせることです。

例えば、音楽配信サービスやテレビ放送では、コンテンツ間の音量差が視聴体験に影響を与えることがあります。具体的には：

- 音楽配信サービスにおける楽曲間の音量差
- テレビ番組と広告の音量差

こうした音量の不均一性を解消するために、音声ファイルを一定の基準値に合わせて調整することを「正規化」と呼びます。

### ラウドネス正規化の技術的特徴

ラウドネス正規化は従来のピーク正規化とは異なり、人間の聴覚特性を考慮した音量調整手法です。

技術的比較：

- **ピーク正規化**：波形の振幅（物理的な音の大きさ）を基準に調整
- **ラウドネス正規化**：聴覚心理モデルに基づいた知覚的音量を基準に調整

人間の聴覚は周波数によって感度が異なるため、同じ振幅値でも周波数特性により知覚される音の大きさは変化します。
ラウドネス正規化はこうした聴覚特性を加味したアルゴリズムにより、より自然な音量バランスを実現します。

### 標準化された基準値

各メディア業界および配信プラットフォームでは、標準化されたラウドネスターゲット値（LUFS）が規定されています：

- 放送基準（ARIB TR-B32）：-24 LUFS
- 音楽ストリーミング：
  - Spotify：-14 LUFS
  - YouTube：-14 LUFS
  - Apple Music：-16 LUFS

LUFS（Loudness Units relative to Full Scale）は、ITU-R BS.1770 規格に基づく測定単位で、人間の聴覚特性を反映した音量の数値表現です。値が大きい（0 に近い）ほど知覚される音量は大きくなります。

### 実務上の留意点

YouTube や Spotify などの主要配信プラットフォームでは、アップロードされたコンテンツに**自動的に**ラウドネス正規化処理が適用されます。
本ツールを活用することで、配信前に適切なラウドネスレベルに調整し、最終的な視聴環境での音量特性を事前に確認することが可能になります。

### 参考文献および技術資料

ラウドネス正規化に関するより専門的な情報は以下の資料を参照してください：

- [適切な音量について考える。ゲームサウンドの「ラウドネス基準」はどうあるべきか](https://www.4gamer.net/games/032/G003263/20121103005)
- [デジタルテレビ放送におけるラウドネス運用規定の国内標準化](https://www.jas-audio.or.jp/journal-pdf/2013/03/201303_022-029.pdf)
- [ラウドネスをめぐる 8 つの疑問【DaVinci Resolve 質問箱】](https://vook.vc/n/2079)
- [Spotify でのラウドネスノーマライゼーション](https://support.spotify.com/jp/artists/article/loudness-normalization)
